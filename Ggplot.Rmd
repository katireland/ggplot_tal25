---
title: "Ivester Institute for Business Analytics and Insights: Intro to Data Visualization with Ggplot2"
output: html_document
date: "2025-08-27"
author: "Katherine A Ireland"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Intro to Data Visualization with Ggplot2

# 0) Background: What is ggplot2?

**ggplot2** implements the *Grammar of Graphics* (Leland Wilkinson), which breaks a visualization into **layers** composed of:

- **Data**: a data frame (rows = observations, columns = variables)
- **Aesthetics** `aes()`: which variables map to **x**, **y**, **color**, **size**, etc.
- **Geometries** `geom_*()`: how to draw marks (points, lines, bars, boxplots…)
- **Scales**: how data values become visual values (axes, colors, sizes)
- **Stats**: transformations like smoothing, binning, summaries
- **Coordinates**: Cartesian (default), polar, etc.
- **Facets**: small multiples by a categorical variable
- **Theme**: non-data styling (fonts, gridlines, background)

It's all about layering to create the visualizations you want/need. 


**Why it matters for business analytics**

- Consistent grammar → fast, repeatable visuals for reports/decks
- Clear mapping from business questions → visual encodings
- Works across disciplines + data 

**Quick references**

- [R for Data Science (R4DS), Chapter on Data Visualization](https://r4ds.had.co.nz/data-visualisation.html)  
- [ggplot2 documentation](https://ggplot2.tidyverse.org/)  
- [Posit (RStudio) ggplot2 Cheatsheet](https://posit.co/resources/cheatsheets/)  

---

# 1) Setup

```{r init, message=FALSE, warning=FALSE}
# If needed (uncomment the next line the first time):
# install.packages("tidyverse")
# Optional for labeled points later:
# install.packages("ggrepel")

library(tidyverse)   # includes ggplot2, dplyr, tidyr, readr, etc.
library(ggrepel)     # optional, for nicer text labels (used in Part B)


```
## Read in our first dataset: Star Wars Characters (generated by chatGPT)

```{r}
library(readr)
sw<- read.csv("https://raw.githubusercontent.com/katireland/ggplot_tal25/refs/heads/main/starwars_characters.csv")
sw <- readr::read_csv("https://raw.githubusercontent.com/katireland/ggplot_tal25/main/starwars_characters.csv")
glimpse(sw)
```
### Step one: aes()
- aesthetics function that tells ggplot how to map data to visuals
- aes() is flexible! It maps any variable in your dataset to a visual property.
- common visual properties include x, y, color, size, shape
- what’s required depends on the geometry (geom_*) you select
```{r}
## aes(x = species) says: "characters per species"

ggplot(sw, aes(x = species))
```

   
Reminder: *Nothing is visualized yet; `aes()` only maps data to visuals; geoms do the drawing.*

### Step 2: geoms

- Geoms determine the geometric shape of the visualization  
- This time we will make a bar chart using `geom_bar()`
- Bar charts are useful for comparing categories

```{r}
ggplot(sw, aes(species)) +
  geom_bar()
```

### Step 3: Add in fill (an optional argument)
```{r}
ggplot(sw, aes(species)) +
  geom_bar(fill = "steelblue") 
ggplot(sw, aes(x=species, fill= species)) +
  geom_bar() 
```
   
       
### Optional step: flip the coordinates so that it is easier to see
   
```{r}
ggplot(sw, aes(species)) +
  geom_bar(fill = "steelblue") +
  coord_flip() 
```

### Step 4: Add in labels
```{r}
ggplot(sw, aes(species)) +
  geom_bar(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Number of Characters by Species",
    x = "Species", y = "Count"
  ) 

```
### Step 5: Add in theme
```{r}
ggplot(sw, aes(species)) +
  geom_bar(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Number of Characters by Species",
    x = "Species", y = "Count"
  ) +
  theme_minimal(base_size = 12)
```

## A different bar chart: the grouped bar chart
```{r}
ggplot(sw, aes(species, fill = eyecolor)) +
  geom_bar()

```
```{r}
ggplot(sw, aes(species, fill = eyecolor)) +
  geom_bar(position = "dodge") #note- what does adding position= "dodge" do?
```

### Dotchart
- useful for visualizing categorical vs. numeric variables
- illustrates how ordered categories compare
```{r}
## forcats::fct_reorder() orders factor levels by a numeric variable.


ggplot(
  sw,
  aes(x = forcats::fct_reorder(character, height), y = height, color = species)
) + geom_point()

```
    
    
### Optional step: Adding labels, etc.
```{r}
ggplot(
  sw,
  aes(forcats::fct_reorder(character, height), height, color = species)
) +
  geom_point(size = 3) +
  coord_flip() +
  labs(
    title = "Character Heights (Ordered), Colored by Species",
    x = "Character", y = "Height (cm)", color = "Species"
  ) +
  theme_minimal(base_size = 12)

```


# The `economics` Dataset

The **`economics`** dataset comes built into the **ggplot2** package.  
It contains monthly U.S. economic indicators from **1967 to 2015**.  

Each row is one month. There are **574 observations** and **[   ] variables**:

- **date**: The month of the observation (class `Date`)  
- **psavert**: *Personal savings rate* — personal savings as a percentage of disposable personal income  
- **pce**: *Personal consumption expenditures* (billions of dollars, seasonally adjusted)  
- **pop**: Total population (in thousands)  
- **uempmed**: Median duration of unemployment (in weeks)  
- **unemploy**: Number of unemployed people (in thousands) 



### Step one: aes()

```{r}
ggplot(economics, aes(x = date, y = psavert))

```
    
Reminder: *Nothing is visualized yet; `aes()` only maps data to visuals; geoms do the drawing.*
     

### Step 2: add in geoms
     
     
```{r}
ggplot(economics, aes(date, psavert)) +
  geom_point()
```
     
### Step 2 continued: try a different geom (in this case, a line chart)
- useful for time series data or trends over time.   
```{r}
ggplot(economics, aes(date, psavert)) +
  geom_line()
```
     
     
### Step 3: add in more layers
```{r}
ggplot(economics, aes(date, psavert)) +
  geom_line(color = "blue") +
  theme_minimal(base_size = 12)
```
     
     
### Step 3 continued: add in even more layers
    
```{r}
ggplot(economics, aes(date, psavert)) +
  geom_line(color = "blue") +
  labs(
    title = "Personal Savings Rate in the U.S. (1967–2015)",
    x = "Year",
    y = "Savings Rate (%)"
  ) +
  theme_minimal(base_size = 12)

```
    
### optional Step: calculated savings rate benchmarks. Let's add a fixed benchmark line at 5%
```{r}

##  horizontal line at y = 5
## This represents a chosen target savings rate.
ggplot(economics, aes(date, psavert)) +
  geom_line(color = "blue") +
  geom_hline(yintercept = 5, linetype = "dashed", color = "red") +
  labs(
    title = "Personal Savings Rate with Fixed 5% Benchmark",
    x = "Year",
    y = "Savings Rate (%)"
  ) +
  theme_minimal()
```
    
Next, we will calculate based on the dataset
     
Instead of choosing a number ourselves, we can let ggplot calculate the average.
- aes(yintercept = mean(psavert, na.rm = TRUE))
- tells ggplot: "Compute the mean savings rate and draw a line at that height."
```{r}
ggplot(economics, aes(date, psavert)) +
  geom_line(color = "blue") +
  geom_hline(aes(yintercept = mean(psavert, na.rm = TRUE)),
             linetype = "dashed", color = "red") +
  labs(
    title = "Personal Savings Rate with Average Benchmark",
    x = "Year",
    y = "Savings Rate (%)"
  ) +
  theme_minimal()
```
     
## Next, visualizing the Chatterjee-Price Attitude Data dataset, which is built into base R

```{r}
?attitude 
head(attitude)
str(attitude)
#what do each of these functions do?


```
### Step one: aes(): let's compare complaints vs overall rating

```{r}
ggplot(attitude, aes(x = complaints, y = rating))
```
    
###Step 2: geoms
   
- For this we will create a scatterplot, which is 
quite useful for comparing two continuous variables.
- Scatterplots are useful for visualizing the relationship between variables.
```{r}
ggplot(attitude, aes(complaints, rating)) +
  geom_point()
```
     
- what type of relationship is this illustrating? Is it what you would expect for complaints and ratings?   

     
### Optional Next Step: adding onto the visualization- a trend line
```{r}
## geom_smooth(method = "lm") draws a linear regression fit.
## se = FALSE hides the shaded confidence band to keep it clean.

ggplot(attitude, aes(complaints, rating)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

### Make it presentation-ready (labels, theme) 
```{r}
ggplot(attitude, aes(complaints, rating)) +
  geom_point(color = "steelblue", alpha = 0.8) +
  geom_smooth(method = "lm", se = FALSE, color = "firebrick") +
  labs(
    title = "Do More Complaints Correlate with Lower Ratings?",
    subtitle = "Each point is a department (scores 0–100)",
    x = "Complaints (higher = more complaints)",
    y = "Overall Department Rating"
  ) +
  theme_minimal(base_size = 12)
```

### Next, A Histogram
- useful for continuous data
- plots one continuous variable to illustrate distributions
- groups the data into intervals (“bins”) along the x-axis.
- The height of each bar shows how many observations (departments, in this case) fall into that interval.
```{r}

## One-variable visual: distribution of ratings across departments.

ggplot(attitude, aes(x = rating)) +
  geom_histogram(bins = 10, boundary = 0, closed = "left") +
  labs(
    title = "Distribution of Department Ratings",
    x = "Overall Rating", y = "Count of Departments"
  ) +
  theme_minimal(base_size = 12)
```

### Your turn! Either use one of these datasets or your own and create a:
- barchart
- scatterplot
- another visualization